<!DOCTYPE html>
<html lang="uk" class="dark">
<head>
    <meta charset="UTF-8">
    <title>–í—Ö—ñ–¥ - TaskBot</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        /* --- Login Specific Styles --- */
        body {
            background-color: #020617;
            display: flex; align-items: center; justify-content: center;
            min-height: 100vh; overflow-y: auto; padding: 20px;
            position: relative; font-family: 'Inter', sans-serif;
            color: white;
        }
        
        /* Background Effects */
        .noise-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
            pointer-events: none; z-index: 0;
        }
        .bg-orb {
            position: absolute; border-radius: 50%; filter: blur(90px); opacity: 0.4; z-index: -1;
            animation: floatOrb 20s ease-in-out infinite alternate;
        }
        .orb-1 { width: 500px; height: 500px; background: var(--color-primary); top: -200px; left: -100px; }
        .orb-2 { width: 400px; height: 400px; background: var(--color-success); bottom: -100px; right: -100px; animation-delay: -5s; }
        
        @keyframes floatOrb { 0% { transform: translate(0, 0); } 100% { transform: translate(30px, 30px); } }

        /* Auth Card */
        .auth-card {
            width: 100%; max-width: 460px;
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            position: relative; z-index: 1;
            overflow: hidden;
            animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .auth-header {
            text-align: center; margin-bottom: 30px;
        }
        .auth-logo {
            font-size: 1.8rem; font-weight: 800; color: white;
            display: inline-flex; align-items: center; gap: 10px;
            text-shadow: 0 0 20px rgba(var(--color-primary-rgb), 0.4);
            margin-bottom: 5px;
        }
        .auth-subtitle { color: var(--color-text-light); font-size: 0.95rem; }

        /* Toggle Tabs */
        .auth-toggle {
            display: flex; background: rgba(0,0,0,0.3);
            padding: 4px; border-radius: 12px; margin-bottom: 30px;
            position: relative; border: 1px solid rgba(255,255,255,0.05);
        }
        .toggle-btn {
            flex: 1; text-align: center; padding: 10px;
            font-size: 0.95rem; font-weight: 600; color: var(--color-text-light);
            cursor: pointer; z-index: 2; transition: color 0.3s;
            border-radius: 10px; user-select: none;
        }
        .toggle-btn.active { color: white; }
        .toggle-bg {
            position: absolute; top: 4px; left: 4px; width: calc(50% - 4px); height: calc(100% - 8px);
            background: var(--color-primary); border-radius: 10px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 1;
            box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.4);
        }
        .auth-toggle.register-active .toggle-bg { transform: translateX(100%); }

        /* Forms */
        .hidden { display: none; }
        /* –ê–Ω—ñ–º–∞—Ü—ñ—ó –¥–ª—è –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è */
        .fade-in { animation: fadeIn 0.4s forwards; }

        .form-group { margin-bottom: 20px; }
        .form-group label {
            font-size: 0.8rem; color: var(--color-text-light); margin-bottom: 8px;
            text-transform: uppercase; letter-spacing: 0.5px; font-weight: 700;
            display: block;
        }
        .form-group input {
            background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1);
            color: white; font-size: 1rem; padding: 12px 16px; border-radius: 12px;
            width: 100%; transition: 0.2s; box-sizing: border-box;
        }
        .form-group input:focus {
            border-color: var(--color-primary); background: rgba(0,0,0,0.4);
            box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.15); outline: none;
        }

        .section-title {
            color: white; font-size: 1rem; font-weight: 600; margin: 25px 0 15px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;
        }

        .feature-checkbox {
            background: rgba(255,255,255,0.03); padding: 12px 15px;
            border-radius: 10px; border: 1px solid rgba(255,255,255,0.05);
            transition: 0.2s; display: flex; align-items: center; gap: 10px;
            margin-bottom: 10px; cursor: pointer; color: var(--color-text-dark);
        }
        .feature-checkbox:hover { background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.1); }
        .feature-checkbox input { width: auto; margin: 0; }
        .feature-checkbox span { color: #e2e8f0; font-size: 0.95rem; }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            border: none; padding: 14px; font-size: 1rem; font-weight: 700;
            margin-top: 10px; width: 100%; color: white; border-radius: 12px;
            cursor: pointer; transition: 0.2s;
            box-shadow: 0 10px 20px -5px rgba(var(--color-primary-rgb), 0.4);
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 15px 25px -5px rgba(var(--color-primary-rgb), 0.5); }
        .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }

        #message {
            margin-top: 20px; text-align: center; font-size: 0.9rem;
            padding: 10px; border-radius: 8px; display: none;
        }
        #message.error { display: block; background: rgba(220, 38, 38, 0.15); color: #fca5a5; border: 1px solid rgba(220, 38, 38, 0.3); }
        #message.success { display: block; background: rgba(22, 163, 74, 0.15); color: #86efac; border: 1px solid rgba(22, 163, 74, 0.3); }

        .back-link {
            text-align: center; margin-top: 30px;
        }
        .back-link a { color: var(--color-text-light); text-decoration: none; font-size: 0.9rem; transition: 0.2s; }
        .back-link a:hover { color: white; text-decoration: underline; }

        /* Loader */
        .loader {
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%; border-top: 2px solid white;
            width: 16px; height: 16px;
            animation: spin 1s linear infinite; display: inline-block;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>


    <div class="bg-orb orb-1"></div>
    <div class="bg-orb orb-2"></div>

    <div class="auth-card">
        <div class="auth-header">
            <div class="auth-logo"><i data-feather="zap"></i> TaskBot</div>
            <div class="auth-subtitle">–ö–µ—Ä—É–π—Ç–µ —Å–≤–æ—ó–º –∫–∞–Ω–∞–ª–æ–º –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ</div>
        </div>

        <div class="auth-toggle" id="authToggle">
            <div class="toggle-bg"></div>
            <div class="toggle-btn active" id="btn-login" onclick="switchMode('login')">–í—Ö—ñ–¥</div>
            <div class="toggle-btn" id="btn-register" onclick="switchMode('register')">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</div>
        </div>
        
        <!-- LOGIN FORM -->
        <form id="loginForm" class="fade-in">
            <div class="form-group">
                <label>–õ–æ–≥—ñ–Ω</label>
                <input type="text" id="login_username" placeholder="–í–∞—à–µ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞" required autocomplete="username">
            </div>
            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="login_password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required autocomplete="current-password">
            </div>
            <button type="submit" class="btn-primary">–£–≤—ñ–π—Ç–∏ <i data-feather="arrow-right" style="width: 18px;"></i></button>
        </form>

        <!-- REGISTER FORM -->
        <form id="registerForm" class="hidden">
            <div class="section-title">–û—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ</div>
            <div class="form-group">
                <label>–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –õ–æ–≥—ñ–Ω</label>
                <input type="text" id="reg_username" placeholder="user123" required autocomplete="username">
            </div>
            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="reg_password" placeholder="–ù–∞–¥—ñ–π–Ω–∏–π –ø–∞—Ä–æ–ª—å" required autocomplete="new-password">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="reg_email" placeholder="mail@example.com" required>
            </div>
            <div class="form-group">
                <label>–í–∞—à Telegram</label>
                <input type="text" id="reg_tg" placeholder="@username" required>
            </div>

            <div class="section-title">–î–∞–Ω—ñ –ö–∞–Ω–∞–ª—É</div>
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞ –∫–∞–Ω–∞–ª—É</label>
                <input type="text" id="reg_ch_name" placeholder="–ù–æ–≤–∏–Ω–∏ –£–∫—Ä–∞—ó–Ω–∏" required>
            </div>
            <div class="form-group">
                <label>ID –ö–∞–Ω–∞–ª—É</label>
                <input type="text" id="reg_ch_id" placeholder="-100..." required>
                <small style="color:var(--color-text-light); font-size: 0.8em; margin-top: 5px; display: block;">* –ë–æ—Ç –º–∞—î –±—É—Ç–∏ –∞–¥–º—ñ–Ω–æ–º –∫–∞–Ω–∞–ª—É</small>
            </div>

            <div class="section-title">–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª</div>
            <label class="feature-checkbox">
                <input type="checkbox" value="tasks" checked> <span>–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å</span>
            </label>
            <label class="feature-checkbox">
                <input type="checkbox" value="schedule" checked> <span>–í—ñ–¥–∫–ª–∞–¥–µ–Ω–∏–π –ø–æ—Å—Ç–∏–Ω–≥</span>
            </label>
            <label class="feature-checkbox">
                <input type="checkbox" value="ai"> <span>AI –†–µ–¥–∞–∫—Ç–æ—Ä (Gemini)</span>
            </label>
            <label class="feature-checkbox">
                <input type="checkbox" value="ads"> <span>–†–µ–∫–ª–∞–º–Ω–∏–π –∫–∞–±—ñ–Ω–µ—Ç</span>
            </label>

            <button type="submit" class="btn-primary" style="background: linear-gradient(135deg, var(--color-success), var(--color-success-dark)); box-shadow: 0 10px 20px -5px rgba(var(--color-success-rgb), 0.4);">–ü–æ–¥–∞—Ç–∏ –∑–∞—è–≤–∫—É</button>
        </form>
        
        <div id="message"></div>
        
        <div class="back-link">
            <a href="landing.html">‚Üê –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
        </div>
    </div>
    
    <div class="mobile-nav">
        <a href="index.html" class="mobile-nav-item">
            <i data-feather="plus-circle"></i>
            <span>–°—Ç–≤–æ—Ä–∏—Ç–∏</span>
        </a>
        <a href="task-list.html" class="mobile-nav-item">
            <i data-feather="list"></i>
            <span>–ó–∞–≤–¥–∞–Ω–Ω—è</span>
        </a>
        <a href="schedule-list.html" class="mobile-nav-item">
            <i data-feather="calendar"></i>
            <span>–ü–ª–∞–Ω</span>
        </a>
        <a href="chat.html" class="mobile-nav-item">
            <i data-feather="message-circle"></i>
            <span>AI –ß–∞—Ç</span>
        </a>
        <a href="settings.html" class="mobile-nav-item">
            <i data-feather="settings"></i>
            <span>–ú–µ–Ω—é</span>
        </a>
    </div>

    <script type="module">
        // üî• –í–ë–£–î–û–í–ê–ù–ò–ô FIX: –ó–∞–º—ñ—Å—Ç—å —ñ–º–ø–æ—Ä—Ç—É –º–∏ –≤–∏–∑–Ω–∞—á–∞—î–º–æ —Ü–µ —Ç—É—Ç
        const backendUrl = 'https://my-telegram-task-bot-5c4258bd3f9b.herokuapp.com';

        feather.replace();

        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const authToggle = document.getElementById('authToggle');
        const message = document.getElementById('message');
        const btnLogin = document.getElementById('btn-login');
        const btnRegister = document.getElementById('btn-register');

        // üî• FIX 2: –ü—Ä–∏–≤'—è–∑—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é –¥–æ window —è–≤–Ω–æ
        window.switchMode = (mode) => {
            message.style.display = 'none';
            message.className = '';
            
            if (mode === 'login') {
                authToggle.classList.remove('register-active');
                btnLogin.classList.add('active');
                btnRegister.classList.remove('active');
                
                loginForm.classList.remove('hidden');
                loginForm.classList.add('fade-in');
                registerForm.classList.add('hidden');
                registerForm.classList.remove('fade-in');
            } else {
                authToggle.classList.add('register-active');
                btnRegister.classList.add('active');
                btnLogin.classList.remove('active');
                
                registerForm.classList.remove('hidden');
                registerForm.classList.add('fade-in');
                loginForm.classList.add('hidden');
                loginForm.classList.remove('fade-in');
            }
        };

        // –í–•–Ü–î
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            message.style.display = 'none';
            
            const btn = loginForm.querySelector('button');
            const originalBtnText = btn.innerHTML;
            btn.innerHTML = '<span class="loader"></span> –í—Ö—ñ–¥...';
            btn.disabled = true;

            const data = {
                username: document.getElementById('login_username').value,
                password: document.getElementById('login_password').value
            };

            try {
                const res = await fetch(`${backendUrl}/api/auth/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                if (res.ok) {
                    const respData = await res.json();
                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('username', data.username);
                    localStorage.setItem('isAdmin', respData.is_admin);
                    localStorage.setItem('allowedPages', JSON.stringify(respData.allowed_pages));

                    if (respData.is_admin) {
                        window.location.href = 'admin.html';
                    } else {
                        window.location.href = 'index.html';
                    }
                } else {
                    const txt = await res.text();
                    message.textContent = txt;
                    message.className = 'error'; // –°—Ç–∏–ª—å –ø–æ–º–∏–ª–∫–∏
                }
            } catch (err) { 
                console.error(err); 
                message.textContent = '–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑\'—î–¥–Ω–∞–Ω–Ω—è.'; 
                message.className = 'error';
            } finally {
                btn.innerHTML = originalBtnText;
                btn.disabled = false;
            }
        });

        // –†–ï–Ñ–°–¢–†–ê–¶–Ü–Ø
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            message.style.display = 'none';
            
            const btn = registerForm.querySelector('button');
            const originalBtnText = btn.innerHTML;
            btn.innerHTML = '<span class="loader"></span> –í—ñ–¥–ø—Ä–∞–≤–∫–∞...';
            btn.disabled = true;
            
            const features = [];
            registerForm.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => features.push(cb.value));

            const data = {
                username: document.getElementById('reg_username').value,
                password: document.getElementById('reg_password').value,
                telegram_username: document.getElementById('reg_tg').value,
                email: document.getElementById('reg_email').value,
                channel_name: document.getElementById('reg_ch_name').value,
                channel_id: document.getElementById('reg_ch_id').value,
                features: features
            };

            try {
                const res = await fetch(`${backendUrl}/api/auth/register`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });

                if (res.ok) {
                    message.textContent = "–ó–∞—è–≤–∫—É —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ! –û—á—ñ–∫—É–π—Ç–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è.";
                    message.className = 'success'; // –°—Ç–∏–ª—å —É—Å–ø—ñ—Ö—É
                    setTimeout(() => window.switchMode('login'), 3000);
                } else {
                    message.textContent = await res.text();
                    message.className = 'error';
                }
            } catch (err) { 
                console.error(err); 
                message.textContent = '–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ'; 
                message.className = 'error';
            } finally {
                btn.innerHTML = originalBtnText;
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>